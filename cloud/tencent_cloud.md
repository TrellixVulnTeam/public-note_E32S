# 一、基础
## 1.CVM(Cloud Virtual Machine)

# (二)、网络
## 一.CLB(Cloud Load Balancer)
* CloudLoadBalancer：负载均衡实例，用于流量分发。
* VIP(virtual IP)：负载均衡向客户端提供服务的 IP 地址。
* Backend/Real Server：后端一组云服务器实例，用于实际处理请求。
* VPC/基础网络：整体网络环境。

负载均衡，访问流量经由 CLB 可以自动分配到云中的多台云服务器上，扩展系统的服务能力并消除单点故障。
| 术语 | 全称 | 说明 |
| ------ | ------ | ------ |
| 负载均衡器 | Cloud Load Balancer | 腾讯云提供的一种网络负载均衡服务，可以结合 CVM 云服务器为用户提供基于 TCP/UDP 以及 HTTP 负载均衡服务 |
| 负载均衡监听器 | Load Balance Listener | 负载均衡服务监听器，包括监听端口、负载均衡策略和健康检查配置等，每个监听项对应后端的一个应用服务 |
| 后端服务器 | Real Server | 接受负载均衡分发请求的一组云服务器实例，负载均衡服务将访问请求按照用户设定的规则转发到这一组后端 CVM 上进行处理 |
| 虚拟服务地址 | Virtual IP | 系统分配的服务地址，当前为 IP 地址。用户可以选择该服务地址是否对外公开，来分别创建公网和私网类型的负载均衡服务 |

## 2.负载均衡分类
### 1).根据原理分类
* 四层负载均衡, 传输层的负载均衡，主要是根据vip和端口信息进行负载均衡。ip+port下可以绑定集群。
    * 负载均衡实例会直接将请求转发到后端实例，而不修改任何数据包(除了将目标ip和端口修改为后端服务器的ip和端口)。负载均衡收到请求之后，会尝试在监听器配置中指定的端口上打开与后端实例的 TCP 连接。
    * CLB在收到SYN包的时候，就会直接转发给后端的服务器，CLB此时类似于一个路由器。
* 七层负载均衡, 应用层的负载均衡，主要是更加应用层的信息来进行负载均衡。可以根据域名+URL下可以绑定集群
    * 七层负载均衡器需要先代理后端服务器和客户端建立连接(三次握手)后，才可能接受到客户端发送的真正应用层内容的报文，然后再根据该报文中的特定字段，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器。
### 2).根据新老分类
* 传统型CLB
* 应用型CLB

## 3.公网内网
公网型负载均衡实例通过 Internet 从客户端获取请求，并向绑定监听器的后端服务器分发这些请求。创建负载均衡器后，腾讯云会给公网负载均衡器分配一个公网域名 （传统型）和 一个 VIP 地址，DNS 服务器将会对域名及 VIP 地址进行解析，公网负载均衡也支持用户添加 CNAME 和 A 记录的绑定，将其映射到用户易读的自定义域名上。公网负载均衡实例均会被分配固定的 BGP 公网 IP，支持接收客户端的 HTTP、HTTPS、TCP、UDP 等请求转发。同时支持会话保持、健康检查等所有腾讯云负载均衡提供的服务。有关公网负载均衡实例使用的限制，请参见 使用约束。

## 4.会话保持
会话保持可使得来自同一 IP 的请求被转发到同一台后端服务器上。默认情况下，负载均衡会将每个请求分别路由到不同后端服务器实例负载。但是，您可以使用会话保持功能使特定用户的请求被路由到同一台后端服务器实例上，这样可以使某些需要保持会话的应用程序（如购物车）合理地工作。

会话保持是负载均衡最常见的问题之一，也是一个相对比较复杂的问题。会话保持有时候又叫做粘滞会话（Sticky Sessions）。会话保持是指在负载均衡器上的一种机制，可以识别客户端与服务器之间交互过程的关连性，在作负载均衡的同时还保证一系列相关连的访问请求会保持分配到一台服务器上｡

* 四层会话保持，四层转发情境支持简单会话保持能力，会话保持时间可设为 30-3600 秒中的任意整数值，超过该时间阈值，会话中无新请求则断开连接。
* 七层会话保持，七层转发情境支持基于 cookie 插入的会话保持能力（由负载均衡器向客户端植入 cookie），会话保持可选时间为30-3600秒。

### 会话保持方案：
* 简单会话保持
    * 负载均衡器在作负载均衡时根据访问请求的源地址作为判断关连会话的依据。
    * 对来自同一 IP 地址的所有访问请求在作负载均衡时都会被保持到一台服务器上去｡
    * 只需要根据数据包三､四层的信息就可以实现，效率比较高。
* Session的会话保持
    * 数据库存放
    * 文件系统存放
    * Memcached存放
* Cookie的会话保持
    * 在基于 cookie 模式下负载均衡器负责插入 cookie，后端服务器无需作出任何修改。
    * 当客户端进行第一次请求时，客户端的 HTTP request（不带 cookie）进入负载均衡器， CLB 根据负载平衡算法策略选择后端一台服务器，并将请求发送至该服务器
    * 后端服务器的 HTTP response（不带 cookie）被发回给负载均衡器。接下来负载均衡器将向该后端服务器插入 cookie 并将 HTTP response 返回到客户端。
    * 当客户请求再次发生时，客户 HTTP request（带有上次负载均衡器插入的 cookie）进入 CLB，然后 CLB 读出 cookie 里的会话保持数值，将 HTTP request发到指定的服务器，然后后端服务器进行请求回复。
    * 由于服务器并不写入cookie，HTTP response 将不带 cookie，该 HTTP response 再次经过进入 CLB 时，CLB 将写入更新后的会话保持 cookie。

## 5.健康检测
* 四层转发健康检查配置，对于TCP的业务，使用 SYN 包进行探测。对于 UDP 业务，使用 Ping 进行检查。
* 七层转发健康检查配置，七层转发的健康检查机制由负载均衡器向后端服务器发送 HTTP 请求来检测后端服务，负载均衡器会通过 HTTP 返回值判断服务是否正常。
### 健康检查频率过高问题
实际上是CLB可能并非一台机器，而是多台机器，配置的健康检查时间是CLB单机进行健康检查的频率。CLB会根据客户端请求，自适应的加大负载均衡集群。

该实现方案的优势是：效率高，探测精准，避免误剔除。比如 CLB 实例集群的 8 台物理机中，其中 1 台判断失败，仅那 1 台机器不再转发流量，另外 7 台的流量是正常的。

### 建议
* 建议跨多个可用区配置负载均衡器的后端CVM实例。如果一个可用区变得不可用，负载均衡器会将流量路由到其他可用区正常运行的实例上去，从而屏蔽可用区故障引起的服务中断问题。

## 二、VPC(Virtual Private Cloud)
私有网络(VPC)是基于腾讯云构建的专属云上网络空间，为您在腾讯云上的资源提供网络服务，不同私有网络间完全逻辑隔离。
### 1.核心概念
* 私有网络网段, 用户在创建VPC时, 需要用CIDR(无类别域间路由) 例如 10.0.0.0/16 作为VPC指定IP地址组。腾讯VPC支持以下3种网段
    * 10.0.0.0 - 10.255.255.255（掩码范围需在16 - 28之间）
    * 172.16.0.0 - 172.31.255.255（掩码范围需在16 - 28之间）
    * 192.168.0.0 - 192.168.255.255 （掩码范围需在16 - 28之间）
    * 一个VPC下的机器需要全部在一个【地域】
* 子网, 一个私有网络至少一个子网。子网的CIDR必须在VPC的CIDR内。私有网络中的所有云资源（如云服务器、云数据库等）都必须部署在子网内。
    * 一个VPC下的不同子网之间可以互相访问
    * 地域下分了多个【可用区】，一个子网下的所有机器都是在同一个【可用区】中。
* 路由表，每个私有网络有一个默认路由表，用户还可以创建自定义路由表。用于控制私有网络 VPC 内子网的出流量走向，每个子网能且只能关联一个路由表，一个路由表可以关联多个子网。
    * 策略由目的端
    * 下一跳类型
    * 下一跳组成

### 2.路由表
#### 1).默认路由表
用户创建私有网络时，系统会自动为其生成一个默认路由表。在之后的子网创建过程中，如果用户没有选择自定义路由表，子网会自动关联该默认路由表。默认路由表的策略可以变更，但是无法删除默认路由表。

#### 2).自定义路由表
自定义路由表可以被删除。可以在 创建子网时关联路由表，或在子网创建后，更换子网关联路由表。

#### 3).路由策略
* 目的端, 目的网段描述
    * 仅支持网段格式，如果希望目的端为单个 IP，可设置掩码为 32（如：172.16.1.1/32）
    * 目的端不能为路由表所在私有网络内的 IP 段，原因是 Local 路由已表示此私有网络内默认内网互通。
    * 默认为Local
* 下一跳类型，私有网络的数据包的出口的类型。私有网络下一跳类型支持 “NAT 网关”、“云服务器”等类型。
    * 云主机（公网网关）：将指向目标网段的流量转发到一个公网网关（开启了转发功能的云服务器）。更多公网网关信息，请参见 公网网关。
    * VPN 网关：将指向目标网段的流量转发到一个 VPN 网关。
    * 专线网关：将指向目标网段的流量转发到一个专线网关。
    * 对等连接：将指向目标网段的流量转发到对等连接另一端的 VPC 。
    * NAT 网关：将指向目标网段的流量转发到一个 NAT 网关。
    * 云服主机：将指向目标网段的流量转发到私有网络内的一台 CVM 实例。
    * 云主机的公网 IP：将指向目标网段的流量转发到私有网络内的一台 CVM 实例的公网 IP（包括普通公网 IP 和弹性 IP）。
* 下一跳，指定具体跳转到的下一跳实例（使用下一跳 ID 标识）

路由表是一个key为目的端，value为下一跳的map。每个机器的网络包，都会被路由表解析，根据目的ip取出下一跳的位置。

每个路由表会有个初始的策略，这个策略是系统路由策略，表示此私有网络内所有资源均内网互通：
* 目的端 Local	
* 下一跳类型 Local
* 下一跳 Local

#### 4).路由策略优先级
路由表中存在多条路由策略时，路由优先级由高至低分别为：
* 私有网络内流量：私有网络内流量最优先匹配。
* 最精确路由（最长前缀匹配）：当路由表中有多条条目可以匹配目的IP时，采用掩码最长（最精确）的一条路由作为匹配项并确定下一跳。
* 公网IP：路由策略均匹配失效时，通过公网 IP 对 Internet 进行外访。

#### 5).NAT网关/EIP优先级说明

### 3.主要功能
* 高性能的 Internet 访问
    * 弹性IP(EIP)，是可以独立申请的公网 IP 地址，支持与实例（如：云服务器、NAT 网关）的动态绑定和解绑。
    * NAT网关，私有网络访问 Internet 的一种方式，能在内外网隔离时，将私有网络中内网 IP 地址和公网 IP 地址进行转换。
    * 公网网关，具备转发 Internet 和私有网络之间流量的功能
* 稳定可靠的用户数据中心连接
    * VPN连接, 通过公网加密通道连接您 IDC 和腾讯云私有网络的方式。
    * 专线接入, 通过物理专线打通您数据中心与多地域腾讯云计算资源的服务。
* 互通的腾讯云上资源
    * 对等连接， 连接两个私有网络的服务。
    * 云联网
    * 基础网络互通，打通基础网络中的云服务器与私有网络之间的网络通信

### 4.地域与可用区
腾讯云托管机房分布在全球多个位置，这些位置节点称为地域（Region），每个地域又由多个可用区（Zone）构成。创建私有网络时需要选择地域，创建子网时需要选择可用区，且子网必须在私有网络所在地域内。
* 地域, 域命名采用【覆盖范围＋机房所在城市】结构，例如：华南地区（广州）、华东地区（上海）
    * 择最靠近您客户的地域，以降低访问时延、提高访问速度。
* 可用区, 保证可用区间的故障相互隔离，不出现故障扩散，确保用户业务持续在线。
    * 一个 VPC 的场景下，我们也建议您至少将业务部署在不同的可用区，以保证可用区间的故障隔离，实现跨可用区容灾。
    * 不同可用区之间可能会有网络的通信延迟，需要结合业务的实际需求进行评估，在高可用和低延迟之间找到最佳平衡点。

### 5.基础网络
基础网络是腾讯云上所有用户的公共网络资源池（如下图右所示）。所有云服务器的内网 IP 地址都由腾讯云统一分配，配置简单，使用方便，适合对操作易用性要求比较高、需要快速使用云服务器的场景。

基础网络和私有网络默认不互通，若需要内部互通，需要采用基础网络互通服务。

由于基础网络资源日益紧缺且无法扩增，2017年6月13日后，新注册的账号已不支持基础网络，即无法在基础网络内创建实例（云服务器、负载均衡等），仅支持私有网络。

### 6.网络ACL(Access Control List)
网络访问控制列表(ACL)是一个子网级别无状态的可选安全层，用于控制进出子网的数据流，可以精确到协议和端口粒度。

### 7.安全组
安全组是一种有状态的包过滤功能虚拟防火墙，用于设置单台或多台云服务器的网络访问控制
* 安全组是一个逻辑上的分组，可以将同一地域内具有相同网络安全隔离需求的基础网络云服务器或弹性网卡实例加到同一个安全组内。
* 您可以通过安全组策略对实例的出入流量进行安全过滤，实例可以是基础网络云服务器或弹性网卡实例 。
* 您可以随时修改安全组的规则。新规则立即生效。

| 安全组 | 网络 ACL |
| ------ | ------ |
| 在实例级别的操作（第一防御层） | 在子网级别的操作（第二防御层） |
| 支持允许规则和拒绝规则 | 支持允许规则和拒绝规则 |
| 有状态：返回数据流会被自动允许，不受任何规则的影响 | 无状态：返回数据流必须被规则明确允许 |
| 只有在启动实例的同时指定安全组、或稍后将安全组与实例关联的情况下，操作才会被应用到实例 | 自动应用到关联子网内的所有 CVM 实例 |

## 三、弹性网卡
## 四、NAT网关
## 五、对等连接
## 六、VPN连接
## 七、云联网
## 八、anycast

# (三)、CDN与加速
## 一、GAAP(Global Application Accelerate Platform)
全球应用加速(GAAP), 依赖全球节点之间的高速通道、转发集群及智能路由技术，实现各地用户的就近接入，通过高速通道直达源站区域，帮助业务解决全球用户访问卡顿或者延迟过高的问题。