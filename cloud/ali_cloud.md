# 一、FunctionCompute
函数计算，是ServerLess的一种具体表现形式:
* 弹性扩容
* 事件驱动的方式触发应用响应用户请求
* 提供日志查询、性能监控和报警等功能
* 按需付费，支持百毫秒级别收费。只需为实际使用的计算资源付费，适合有明显波峰波谷的用户访问场景。

# 二、构建
## 1.服务
服务是函数计算资源管理的单位。服务下的所有函数共享一些相同的设置，例如服务授权、配置日志。同一服务下有多个函数，这些函数共享服务配置的资源(例如日志库，服务角色等)
## 2.函数
* 函数信息:
    * functionName（必选）： 函数的名字。
    * runtime（必选）： 函数运行时类型。
    * code（必选）： 代码包。必须是 zip 类型，可以存放在 OSS 上，或者直接上传。
    * handler（必选）： 处理函数，它是函数计算系统运行用户函数的调用入口。
    * description（可选）： 函数的描述。函数计算系统并不会使用该属性值，但建议您为服务设置一个简洁、清晰的描述。
    * timeout（可选）： 函数的最大运行时间，单位为秒。
    * MemorySize（可选）： 函数运行所需的内存资源，单位为 MB。取值范围为 [128, 3072]，以 64 MB 为步长递进。
    * Initializer（可选）： initializer 入口，它是函数计算系统运行用户 initializer 函数的调用入口。
    * InitializationTimeout（可选）： initializer 最大运行时间，单位为秒。
### 1).函数入口
* 处理函数入口
* Initializer函数入口, 这个只是可选的, 进行统一的初始化

函数计算首先先执行 initializer，待 initializer 执行成功之后，再执行处理函数。
### 3).函数参数
* 处理函数入口有两个参数: event和context
* Initializer函数入口只有一个参数: context

### 4).第三方依赖
函数计算的运行环境内置了一些常用的依赖库，可以直接在函数中引用。云平台上不存在的依赖需要进行打包，然后与函数代码一起进行打包上传。

### 5).触发器

## 2.权限控制
访问控制服务 RAM (Resource Access Management) 是阿里云提供的资源访问控制服务。

# 二、LogService
功能:
* 实时采集与消费(LogHub)
    * 通过ECS、容器、移动端，开源软件，JS等接入实时日志数据
    * 提供实时消费接口，与实时计算及服务对接
* 查询与实时分析(Search/Analytics)
    * 查询：关键词、模糊、上下文、范围
    * 统计：SQL聚合等丰富查询手段
    * 可视化：Dashboard + 报表功能
    * 对接：Grafana，JDBC/SQL92
* 投递数仓(LogShipper)
    * 将日志中枢数据投递至存储类服务进行存储。支持压缩、自定义Partition、以及行列等各种存储方式。
    * 用途：数据仓库 + 数据分析、审计、推荐系统与用户画像。

## 1.基本概念
![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13012/15481751232389_zh-CN.png)
### 1).日志
日志(Log)是系统在运行过程中变化的一种抽象，其内容为指定对象的某些操作和其操作结果按时间的有序集合。文件日志（LogFile）、事件（Event）、数据库日志（BinLog）、度量（Metric）数据都是日志的不同载体。在文件日志中，每个日志文件由一条或多条日志组成，每条日志描述了一次单独的系统事件，是日志服务中处理的最小数据单元。日志服务采用半结构数据模式定义一条日志。该模式中包含主题（Topic）、时间（Time）、内容（Content）和来源（Source）四个数据域:
* 主题(topic), 用户自定义字段，用以标记一批日志。例如访问日志可根据不同站点进行标记。
* 时间(time), 日志中的保留字段，用以表示日志产生的时间，一般由日志中的时间信息直接提取生成。
* 内容(content), 用以记录日志的具体内容。内容部分由一个或多个内容项组成，每一个内容项为一个Key-Value对。
* 来源(source), 日志的来源地，例如产生该日志机器的IP地址。
* 标签(tags)

### 2).日志组(LogGroup)
是一组日志的集合，写入与读取的基本单位。一个LogGroup中的数据包含相同Meta（IP、Source等信息）。多条日志会打包成一个LogGroup，以LogGroup为单位发往日志服务。相对于以日志为单位读写数据，LogGroup的读写方式可以最大限度地减少读取与写入次数，提高业务效率。看起来就是一种缓存日志的方案。

### 3).日志主题(Topic)
一个日志库内的日志可以通过日志主题（Topic）来划分。用户可以在写入时指定日志主题，并在查询时指定查询的日志主题。

### 4).项目（Project）
日志服务中的资源管理单元，用于资源隔离和控制。您可以通过项目来管理某一个应用的所有日志及相关的日志源。它管理着用户的所有日志库（Logstore），采集日志的机器配置等信息，同时它也是用户访问日志服务资源的入口。
* 帮助您组织、管理不同的Logstore。在实际使用中，您可能需要使用日志服务集中收集、存储不同项目、产品或者环境的日志。您可以把不同项目、产品或者环境的日志分类管理在不同的项目中，方便后续的日志消费、导出或者索引。同时，项目还是日志访问权限管理的载体。
* 提供您日志服务资源的访问入口。每创建一个项目，日志服务会为该项目分配一个独有的访问入口。该访问入口支持通过网络写入、读取及管理日志。

### 5).日志库（Logstore）
日志服务中日志数据的收集、存储和查询单元。每个日志库隶属于一个项目，且每个项目可以创建多个日志库。每个日志库隶属于一个项目，且每个项目可以创建多个日志库。您可以根据实际需求为某一个项目生成多个日志库，其中常见的做法是为一个应用中的每类日志创建一个独立的日志库。也就是不同类型或不同用途的日志，需要建立与之对应的日志库。

### 6).分区（Shard）
每个日志库分若干个分区（Shard），每个分区由MD5左闭右开区间组成，每个区间范围不会相互覆盖，并且所有的区间的范围是MD5整个取值范围。Logstore读写日志必定保存在某一个分区（Shard）上。每个Shared都具有一定的读写能力，当Shard个数越多，该Logstore的并发性能越强。
* 写入：5MB/s，500次/s
* 读取：10MB/s，100次/s

根据实际数据流量规划分区个数，流量超出读写能力时，及时分裂分区以增加分区个数，从而达到更大的读写能力；如您的流量远远达不到分区的最大读写能力时，建议您合并分区以减少分区个数，从而节约分区租赁费用。

## 2.采集ECS日志
可以通过Logtail进程采集ECS日志，该进程会收集日志文件，并上报到LogService, 这是一种对代码无侵入的方案：
* 首先需要在被采集的机器上安装LogTail进程
* 在LogService上配置采集的节点，这些节点上需要安装LogTail，LogService和LogTail之间会进行心跳检测
* 创建采集的配置，将输入的各个字段进行配置

### 1).LogTail安装
```sh
wget http://logtail-release-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/linux64/logtail.sh -O logtail.sh;chmod 755 logtail.sh
./logtail.sh install auto
```